<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="theme-color" content="#0a0a0a">
    <title>AgentG - Mobile Monitor</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div class="app">
        <!-- Header -->
        <header class="header">
            <div class="header-left">
                <div class="logo">AgentG</div>
                <div class="connection-status">
                    <span class="status-dot" id="statusDot"></span>
                    <span id="statusText">Connecting...</span>
                </div>
            </div>
            <div class="header-right">
                <button class="header-btn" id="instanceBtn" aria-label="Switch session" title="Switch session">&#8645;</button>
                <button class="theme-toggle" id="themeToggle" aria-label="Toggle theme">
                    <span id="themeIcon">üåô</span>
                </button>
            </div>
        </header>

        <!-- Chat Display (Snapshot) -->
        <div class="chat-container" id="chatContainer">
            <div class="chat-content" id="chatContent">
                <div class="loading-state">
                    <div class="spinner"></div>
                    <p>Loading chat...</p>
                </div>
            </div>
        </div>

        <!-- Pending Action Bar (hidden by default) -->
        <div class="action-bar hidden" id="actionBar">
            <div class="action-info">
                <span class="action-icon">‚ö°</span>
                <span class="action-text" id="actionText">Run command?</span>
            </div>
            <div class="action-buttons">
                <button class="action-btn reject-btn" id="rejectBtn" aria-label="Reject">
                    ‚úï Reject
                </button>
                <button class="action-btn accept-btn" id="acceptBtn" aria-label="Accept">
                    ‚úì Accept
                </button>
            </div>
        </div>

        <!-- Input Section -->
        <div class="input-section">
            <div class="controls-row" id="controlsRow">
                <button class="control-chip" id="modeChip" title="Current mode">--</button>
                <button class="control-chip" id="modelChip" title="Current model">--</button>
            </div>
            <div class="file-preview-area hidden" id="filePreviewArea"></div>
            <div class="input-row">
                <button class="toolbar-btn" id="attachBtn" aria-label="Attach file" title="Add files">üìé</button>
                <button class="toolbar-btn" id="voiceBtn" aria-label="Voice recording"
                    title="Hold to record">üéôÔ∏è</button>
                <textarea class="message-input" id="messageInput" placeholder="Type a message..." rows="1"
                    aria-label="Message input"></textarea>
                <button class="send-btn" id="sendBtn" aria-label="Send message">Send</button>
            </div>
        </div>

        <!-- Scroll to Bottom FAB -->
        <button class="scroll-fab" id="scrollFab" aria-label="Scroll to bottom">‚Üì</button>
    </div> <!-- End of .app container -->

    <!-- Voice Recording Overlay -->
    <div class="voice-recording-overlay" id="voiceOverlay">
        <div class="voice-recording-card">
            <div class="voice-waveform">
                <canvas id="waveformCanvas" width="220" height="100"></canvas>
            </div>
            <div class="voice-timer" id="voiceTimer">0:00</div>
            <p style="color: var(--text-secondary); font-size: 14px;">Recording audio...</p>
            <div class="voice-actions">
                <button class="voice-btn voice-btn-cancel" id="voiceCancelBtn">Cancel</button>
                <button class="voice-btn voice-btn-stop hidden" id="voiceStopBtn"
                    style="background: var(--error); color: white;">Stop</button>
                <button class="voice-btn voice-btn-send hidden" id="voiceSendBtn">Send</button>
            </div>
        </div>
    </div>



    <!-- Step Confirmation Popup -->
    <div class="modal-overlay" id="confirmationPopup">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">‚ö†Ô∏è Confirmation Required</h2>
            </div>
            <div class="modal-body">
                <p id="confirmMessage" style="font-size: 14px; line-height: 1.5; margin-bottom: 16px;">
                    Confirmation required to execute this step
                </p>
            </div>
            <div class="modal-footer" style="padding: 16px; display: flex; gap: 12px; justify-content: flex-end;">
                <button class="action-btn reject-btn" id="denyBtn" style="width: auto; padding: 8px 24px;">
                    Deny
                </button>
                <button class="action-btn accept-btn" id="confirmBtn" style="width: auto; padding: 8px 24px;">
                    Confirm
                </button>
            </div>
        </div>
    </div>

    <!-- Browser Permission Warning -->
    <div class="modal-overlay warning-popup" id="permissionWarning">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">‚ö†Ô∏è Permission Required</h2>
            </div>
            <div class="modal-body">
                <p id="permissionMessage" style="font-size: 14px; line-height: 1.5; margin-bottom: 16px;">
                    Antigravity needs browser permission on desktop. Please grant permission on your PC.
                </p>
                <div
                    style="background: var(--bg-tertiary); padding: 12px; border-radius: 8px; font-size: 13px; color: var(--text-secondary);">
                    üí° This is a browser security dialog that cannot be clicked remotely. You must grant permission once
                    on your desktop, then it will be remembered.
                </div>
            </div>
            <div class="modal-footer" style="padding: 16px; display: flex; justify-content: flex-end;">
                <button class="action-btn accept-btn" id="dismissBtn" style="width: auto; padding: 8px 24px;">
                    Dismiss
                </button>
            </div>
        </div>
    </div>

    <!-- Tool Permission Popup -->
    <div class="modal-overlay" id="toolPermissionPopup">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">üîê Permission Request</h2>
            </div>
            <div class="modal-body">
                <p id="toolPermissionMessage" style="font-size: 14px; line-height: 1.5; margin-bottom: 16px;">
                    Tool permission required
                </p>
            </div>
            <div class="modal-footer" style="padding: 16px; display: flex; gap: 8px; justify-content: flex-end; flex-wrap: wrap;">
                <button class="action-btn reject-btn" id="toolDenyBtn" style="width: auto; padding: 8px 16px;">
                    Deny
                </button>
                <button class="action-btn" id="toolAllowOnceBtn" style="width: auto; padding: 8px 16px; background: #f59e0b; color: #000; font-weight: 600; border: none; border-radius: 8px; cursor: pointer;">
                    Allow Once
                </button>
                <button class="action-btn accept-btn" id="toolAllowConvBtn" style="width: auto; padding: 8px 16px;">
                    Allow All
                </button>
            </div>
        </div>
    </div>

    <!-- Mic Setup Modal -->
    <div class="modal-overlay" id="micSetupModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">üéôÔ∏è Microphone Setup</h2>
                <button class="modal-close" id="micModalClose" aria-label="Close">√ó</button>
            </div>
            <div class="modal-body">
                <p style="margin-bottom: 16px; font-size: 14px; line-height: 1.5;">
                    Microphone access requires HTTPS. To use it on this local IP, please authorize it in Chrome:
                </p>

                <div style="background: var(--bg-tertiary); padding: 12px; border-radius: 8px; margin-bottom: 16px;">
                    <div style="font-size: 12px; color: var(--text-secondary); margin-bottom: 4px;">1. Copy this URL:
                    </div>
                    <div style="display: flex; gap: 8px; align-items: center;">
                        <input type="text" id="micFlagUrl"
                            value="chrome://flags/#unsafely-treat-insecure-origin-as-secure" readonly
                            style="flex: 1; background: transparent; border: none; color: var(--accent-primary); font-family: monospace; font-size: 13px; outline: none;">
                        <button id="copyFlagBtn"
                            style="background: var(--accent-primary); color: white; border: none; padding: 4px 8px; border-radius: 4px; font-size: 12px; cursor: pointer;">Copy</button>
                    </div>
                </div>

                <div style="font-size: 14px; line-height: 1.6;">
                    2. Open it in a new tab.<br>
                    3. Set to <b>Enabled</b>.<br>
                    4. Add <code id="micServerUrl" style="color: var(--accent-primary);"></code> to the list.<br>
                    5. <b>Relaunch</b> Chrome.
                </div>
            </div>
            <div class="modal-footer" style="padding: 16px; display: flex; justify-content: flex-end;">
                <button class="action-btn accept-btn" id="micModalOk"
                    style="width: auto; padding: 8px 24px;">Understood</button>
            </div>
        </div>
    </div>

    <!-- Instance Switcher Modal -->
    <div class="modal-overlay" id="instanceModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Chat Sessions</h2>
                <button class="modal-close" id="instanceClose" aria-label="Close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="option-list" id="instanceList"></div>
            </div>
        </div>
    </div>

    <!-- Model Selection Modal -->
    <div class="modal-overlay" id="modelModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Select Model</h2>
                <button class="modal-close" id="modelClose" aria-label="Close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="option-list" id="modelList"></div>
            </div>
        </div>
    </div>

    <!-- Mode Selection Modal -->
    <div class="modal-overlay" id="modeModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Select Mode</h2>
                <button class="modal-close" id="modeClose" aria-label="Close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="option-list" id="modeList"></div>
            </div>
        </div>
    </div>

    <!-- Hidden file input -->
    <input type="file" id="fileInput" multiple accept="*/*" class="hidden">

    <!-- Scripts -->
    <script src="js/theme.js"></script>
    <script src="js/websocket.js"></script>
    <script src="js/snapshot.js"></script>
    <script src="js/fileUpload.js"></script>
    <script src="js/voiceRecorder.js"></script>
    <script src="js/actionManager.js"></script>
    <script src="js/instanceManager.js"></script>
    <script src="js/controlsManager.js"></script>
    <script src="js/main.js"></script>
</body>

</html>